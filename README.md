# Sprite Fusion Pixel Snapper

**Online version**: [spritefusion.com/pixel-snapper](https://spritefusion.com/pixel-snapper)

A high-performance, multi-threaded engine to snap pixels to a perfect grid. Specifically engineered to fix messy and inconsistent pixel art generated by AI.

<img src="./static/hero.png" alt="Pixel Snapper" style="width: 100%; image-rendering: pixelated;">

## ğŸï¸ Performance & Features

Pixel Snapper has been engineered for extreme speed and professional high-throughput workflows:

- **ğŸš€ Sub-Second Milestone**: Process 1.3M+ pixels in **~0.96s** on Apple Silicon.
- **ğŸ Native ARM64 Optimization**: Leverages **NEON SIMD** instructions and fixed-point math for peak efficiency on M-series chips.
- **ğŸ§µ Multi-Threaded Engine**: Powered by `rayon` for parallel perceptual quantization and grid detection.
- **ğŸ“‚ Recursive Batch Processing**: Point the CLI at a folder, and it automatically crawls and processes all images within.
- **ğŸ§  Intelligent Auto-Detection**: Heuristically determines optimal color palettes (K) and grid density without user input.
- **ğŸ§ª AI-Robustness**: Hardened logic to handle the noisy, non-uniform grids typical of AI-generated assets.

## ğŸ¨ Why Pixel Snapper?

**Current AI image models struggle with strict grid-based pixel art:**
- Pixels are inconsistent in size and position.
- The grid resolution can drift across the canvas.
- Colors often bleed or deviate from a clean palette.

**With Pixel Snapper:**
- âœ… Pixels are snapped to a mathematically perfect grid.
- âœ… The grid resolution is stabilized and consistent across the whole image.
- âœ… Colors are tied to a strict, perceptually quantized Lab-space palette.

<img src="./static/details.png" alt="Details" style="width: 100%; image-rendering: pixelated;">
<p align center><em>Pixel Snapper preserves high-fidelity details like dithering while fixing grid drift.</em></p>

## ğŸ› ï¸ Usage

### ğŸ’» CLI (Recursive & High-Speed)

Requires [Rust](https://www.rust-lang.org/) installed.

```bash
git clone https://github.com/sabraman/spritefusion-pixel-snapper.git
cd spritefusion-pixel-snapper
cargo build --release
```

**Single Image:**
```bash
./target/release/spritefusion-pixel-snapper input.png --output output.png
```

**Recursively process a folder:**
```bash
./target/release/spritefusion-pixel-snapper ./assets --output ./processed
```

**Custom color quantization (e.g., 16 colors):**
```bash
./target/release/spritefusion-pixel-snapper input.png --output output.png --k-colors 16
```

### ğŸŒ Web (WASM)

Build for highly efficient browser-based snapping:

```bash
wasm-pack build --target web --release
```

## ğŸ—ï¸ Architecture

The project is structured as a high-quality Rust library and a thin CLI wrapper, allowing for easy integration into other tools or WASM-based web apps.

- `src/grid.rs`: Single-pass, cache-optimized grid detection.
- `src/quantize.rs`: Parallel perceptual clustering using Hamerly K-Means.
- `src/resample.rs`: Multi-threaded $O(N)$ candidate resolution.

## ğŸ¤ Acknowledgments

Pixel Snapper is a [Sprite Fusion](https://spritefusion.com) project. Sprite Fusion is a free, web-based tilemap editor supporting Unity, Godot, Defold, and GB Studio.

<img src="./static/spritefusion.webp" alt="Sprite Fusion" style="width: 100%;">

## ğŸ“„ License

MIT License [Hugo Duprez](https://www.hugoduprez.com/)
